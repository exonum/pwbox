dist: trusty
sudo: false
cache:
  directories:
  - node_modules
branches:
  only:
  - master
  - "/^v\\d+\\.\\d+(\\.\\d+)?(-\\S*)?$/"
language: node_js
node_js:
- '6'
- '8'
- '10'
env:
- TEST_SUITE=unittests
matrix:
  include:
  - node_js: '6'
    env: TEST_SUITE=browsers
  - node_js: '6'
    env: TEST_SUITE=demo
before_script:
- npm install -g mocha-cli
- |
  case "$TEST_SUITE" in
    browsers )
      npm install -g karma-cli
      export DISPLAY=:99.0
      sh -e /etc/init.d/xvfb start
      sleep 3;;
  esac
script:
- npm run-script lint
- |
  case "$TEST_SUITE" in
    unittests ) npm test;;
    browsers ) npm run coverage-browsers;;
    demo ) npm run test-demo;;
  esac
after_script:
- |
  if [[ "$TEST_SUITE" == "browsers" ]]; then
    cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js
  fi
deploy:
  provider: npm
  email: exonum.bitfury@gmail.com
  api_key:
    secure: ZlscbOycAUpD7EpJNZSPC1KtnX4JbV2D2A0/vppmJCcrSKatKWXaVeRMj2EhF8zEW5/xXNU0XzGJMNrQxtnNZ8fJY8r1QkX0TzwiTJ/rkUsE0tP5igTbju3I4ErbucFQs35wbpfJZP4kpOvcIgTBRSbGQ3V8zHGCb14h8c1MXRrlZ/uEfx7jXGvqsy2AWPlJ7mtEeqrYXuUFfuMQHrDZQP1s0P6FvUwnCbrSIFuo/uEO/iSnisDTmlujunaviMa7jx2qIKN5BdrgAfhSQGHpNNbrOT9CmWKvsIr9MNoWbbGqdTueafmopdzV6Im7lxSgSyhun7L85qz3r4IPOxWcofYWqrlNMvWBNIxerzUXj6qLTQX1bN3w9T8bbIhqxdiu0+L/reViWLi+Y9HEODrwk/TCiaQcTI0UPEf9/PEIdW6NXdcY0eTzbQzhAd9S62pzkfagSe6+v4vG4z+EfknRx2v/K7qXUwUG/GUTmr7RieUuLFAuioQe6GaYo2Mx5wQ7GDra0viwZR6q3LqEfOA4j4I/n73g192NQPxnq89AHQRdYtmyI53pOG0h/qOS2DyGS1QYKwrTwg8COjmHePjNQvsFp8oQDOTTCe/QRrkw1lJ+q6XproYUTBPdiej+OW7ooy39W/AzW213JHUPXxmC9WxCVtTKGmLH/+B7/OdLABM=
  on:
    branch: master
    tags: true
    repo: exonum/pwbox
    node: '8'
  skip_cleanup: true
